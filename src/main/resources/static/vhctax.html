<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  	<link rel="stylesheet" type="text/css" href="/css/nprogress.css">
  	<link rel="stylesheet" type="text/css" href="/css/jquery-ui.min.css">
	<link rel="stylesheet" type="text/css" href="/css/modules.min.css">
	<link rel="stylesheet" type="text/css" href="/css/scrolltabs.css">
	<link rel="stylesheet" type="text/css" href="/css/report.css">
<style>
	.right-column-content-container {min-width: 1000px;}
	.ui.form .field input {padding: 0.5em;}
	.plain-text {font-weight: normal !important; font-size: 0.9em !important;}
	.ui.checkbox.no-label {font-size: 0;}
	.ui.small.tax.form .fields {margin-bottom: 0.35em;}
	.tax-reg-photo {width: 100px; height: 80px;}
	.ui.table > tbody > tr.selected {background-color: #4085e5; color: white;}
	img.tax-reg-photo:hover {cursor: pointer;}
</style>
	<title>Next Generation Smart FMS Platform</title>
</head>
<body>
<div class="ui fixed main secondary small blue inverted menu" id="topMenu">
	<div class="ui container">
		<a class="tracking enabled item"><i class="road icon"></i> Vehicle Tracking</a>
		<a class="fuel report enabled item"><i class="bar chart icon"></i> Fuel Efficiency</a>
		<a class="filling report enabled item"><i class="chart line icon"></i> Filling</a>
		<a class="draining report item"><i class="chart line icon"></i> Draining</a>
		<a class="vehicle tax active enabled item"><i class="yellow tasks icon"></i> Vehicle Tax</a>
		<div class="right menu">
			<a class="ui logout item" href="/login.html" title="Sign out"><i class="sign-out icon"></i></a>
		</div>
	</div>
</div>

<div class="main-container">
	<div class="left-column">
		<div class="ui raised segment">
			<div class="ui blue top attached label"><i class="rupee sign icon"></i>Vehicle Tax Management</div>
			<div class="left-column-content-container">	
				<div class="ui blue vertical fluid secondary pointing small menu" id="taxSubMenu">
					<a class="active payment task item"><i class="bell icon"></i>Vehicle Tax Payment Task</a>
					<a class="tax template item"><i class="copy icon"></i>Payment Task Templates</a>
	   			</div>
	   		</div>
		</div>
	</div>
	<div class="right-column">
		<div class="right-column-content-container">
			<div class="ui small unstackable form" id="actionFrm" style="padding-top: 0.5em;">
				<div class="inline fields">
					<div class="four wide field">
						<label>Payment type:</label>
						<div class="ui selection dropdown" style="min-width: 11em;">
							<i class="dropdown icon"></i>
							<input type='hidden' name="taskType">
							<div class="default text">All</div>
							<div class="ui menu">
								<div class="item" data-value="">All</div>
								<div class="item" data-value="C">Certification No.</div>
								<div class="item" data-value="T">Tax No.</div>
							</div>
						</div>
					</div>
					<div class="seven wide inline field">
						<label>Period:</label>
						<div class="ui small left icon input">
							<input type="text" placeholder="Date from" id="fromDate" name="fromDate"><i class="calendar alternate outline icon"></i>
						</div>
						&nbsp;~&nbsp;
						<div class="ui small right icon input">
							<input type="text" placeholder="Date to" id="toDate" name="toDate"><i class="calendar alternate outline icon"></i>
						</div>
					</div>
					<div class="four wide field" id="actionButtons">
						<div class="ui orange tiny compact icon basic add button" title="add new tax payment task"><i class="plus icon"></i></div>
						<div class="ui tiny compact icon basic button"><i class="check icon"></i></div>
						<div class="ui tiny compact icon basic button print"><i class="print icon"></i></div>
						<div class="ui tiny compact icon basic button remove"><i class="trash alternate icon"></i></div>
					</div>
					<div class="one wide field">
						<div class="ui compact blue search icon button"><i class="search icon"></i></div>
					</div>
				</div>
			</div>
			<div class="ui basic segment" style="padding:0; margin: 0;">
				<div class="ui loader" id="taskTableLoader"></div>
				<table class="ui celled teal striped compact small unstackable table" id="taskListTable" style="margin-top: 0.2em;">
					<thead>
					<tr>
						<th class="center aligned collapsing"><div class="ui checkbox no-label chkAll"><input type="checkbox" name="chkAll"></div></th>
						<th class="center aligned">Label</th>
						<th class="center aligned">Model</th>
						<th class="center aligned">Plate No.</th>
						<th class="center aligned">Payment Type</th>
						<th class="center aligned">Cost</th>
						<th class="center aligned">Due Date</th>
						<th class="center aligned">Status</th>
					</tr>
					</thead>
					<tbody></tbody>
				</table>
			</div>	
		</div><!-- end of right column content container -->
	</div><!--  end of right column -->
</div><!-- end of main -->
<div class="ui segment modal" id="registModal">
	<div class="ui small form tax">
		<div class="fields">
			<div class="four wide field">
				<div class="ui segment" style="padding-left: 0.3em; padding-right: 0.3em;">
					<div class="ui top attached blue label"><i class="car icon"></i> Vehicle List</div>
					<div style="overflow: auto; max-height: 430px;"><table class="ui small small basic table"><tbody></tbody></table></div>
				</div>
			</div>
			<div class="twelve wide field">
				<div class="ui segment">
					<div class="ui top attached blue label">Tax Payment Task</div>
					<div class="fields">
						<div class="ten wide field">
							<label class="plain-text"><i class="copy outline icon"></i>Apply Template</label>
							<div class="ui fluid search selection dropdown" id="templateDropdown">
								<i class="dropdown icon"></i>
								<input type="hidden" name="tmplId">
								<div class="default text">Select Template to apply</div>
								<div class="ui menu"></div>
							</div>
						</div>
						<div class="six wide field">
							<label class="plain-text"><i class="grey clone icon"></i>Apply Task To</label>
							<div class="inline fields" style="padding-top: 0.5em;">
								<div class="field"><div class="ui radio checked checkbox applyTo all"><label>All</label><input type="radio" name="applyTo" value="all"></div></div>
								<div class="field"><div class="ui radio checkbox applyTo cert"><label>Certification</label><input type="radio" name="applyTo" value="cert"></div></div>
								<div class="field"><div class="ui radio checkbox applyTo tax"><label>Tax</label><input type="radio" name="applyTo" value="tax"></div></div>
							</div>
						</div>
					</div>
					<div class="ui horizontal divider"><i class="car grey icon"></i>&nbsp;<span class="plain-text">Vehicle Certification</span></div>
					
					<div class="ui form" id="certRegistFrm">
						<div class="fields">
							<div class="twelve wide field">
								<div class="fields">
									<div class="eight wide field"><label class="plain-text">Certification No.</label><div class="ui small input"><input type="text" name="registrationNo"></div></div>
									<div class="eight wide field"><label class="plain-text">Valid Till</label><div class="ui small right icon input"><input type="text" name="dateValidTill" id="certValidTill"><i class="calendar alternate outline icon"></i></div></div>
								</div>
								<div class="fields">
									<div class="eight wide field"><label class="plain-text">Cost</label><div class="ui small right icon input"><input type="text" class="certcost-input" name="cost" style="text-align: right;"><i class="rupee icon"></i></div></div>
									<div class="eight wide field"><label class="plain-text">Remind Before</label><div class="ui small input"><input type="number" name="remindBeforeDays" style="text-align: right;"></div></div>
								</div>
							</div>
							<div class="four wide field">
								<label class="plain-text">Certification Photo</label><img class="tax-reg-photo" src="/images/dummy_photo.png">
							</div>
						</div>
						<div class="field"><input type='hidden' name='taskType'></div>
					</div>	
						
					<div class="ui horizontal divider"><span class="plain-text"><i class="car grey icon"></i>&nbsp;Vehicle Tax</span></div>
					
					<div class="ui form" id="taxRegistFrm">
						<div class="fields">
							<div class="twelve wide field">		
								<div class="fields">
									<div class="eight wide field"><label class="plain-text">Tax No.</label><div class="ui small input"><input type="text" name="registrationNo"></div></div>
									<div class="eight wide field"><label class="plain-text">Valid Till</label><div class="ui small right icon input"><input type="text" name="dateValidTill" id="taxValidTill"><i class="calendar alternate outline icon"></i></div></div>
								</div>
								<div class="fields">
									<div class="eight wide field"><label class="plain-text">Cost</label><div class="ui small right icon input"><input type="text" class="taxcost-input" name="cost" style="text-align: right;"><i class="rupee icon"></i></div></div>
									<div class="eight wide field"><label class="plain-text">Remind Before</label><div class="ui small input"><input type="number" name="remindBeforeDays" style="text-align: right;"></div></div>
								</div>
							</div>
							<div class="four wide field">
								<label class="plain-text">Tax Photo</label><img class="tax-reg-photo" src="/images/dummy_photo.png">
							</div>
						</div>
						<div class="field"><input type='hidden' name='taskType'></div>
					</div>	
						
					<div class="ui horizontal divider"><i class="grey bell icon"></i>&nbsp;<span class="plain-text">Notification</span></div>
					<div class="fields">
						<div class="eight wide field"><label class="plain-text">SMS Notification</label><div class="ui small left icon input"><input type="text" name="notificationSms"><i class="comments alternate icon"></i></div></div>
						<div class="eight wide field"><label class="plain-text">Email Notification</label><div class="ui small left icon input"><input type="text" name="notificationEmail"><i class="envelope icon"></i></div></div>
					</div>
				</div>
			</div>
		</div>
		<div class="fields">
			<div class="field"><input type="hidden" name="vehicleId"></div>
			<div class="field"><input type="hidden" name="label"></div>
			<div class="field"><input type="hidden" name="model"></div>
			<div class="field"><input type="hidden" name="plateNo"></div>
			<div class="field"><input type="hidden" name="vin"></div>
		</div>
		<div class="error-description field"></div>
		<div class="ui divider"></div>
		<div class="field">
			<div style="text-align: center;">
				<div class="ui blue right labeled icon small basic save compact button">Save<i class="save icon"></i></div>
				<div class="ui right labeled icon small basic close compact button">Close <i class="x icon"></i></div>
			</div>	
		</div>
	</div>
</div>
<div class="ui mini modal" id="confirmModal">
	<div class="ui segment">
		<div class="ui top attached blue label"><i class="info circle icon"></i>Confirmation</div>
		<div class="ui basic center aligned segment">
			<h4 class="ui header"><div class="content">Are you sure?<div class="sub header"></div></div></h4>
			<div class="ui small button primary compact ok">Yes</div>
			<div class="ui small button negative compact cancel">Cancel</div>
		</div>
	</div>
</div>
<script src="/js/nprogress.js"></script>
<script src="/js/jquery-3.1.1.min.js"></script>
<script src="/js/jquery-ui.min.js"></script>
<script src="/js/modules.min.js"></script>
<script src="/js/cleave.min.js"></script>
<script src="/js/common.api.js"></script>
<script src="/js/common.js?v=1.1"></script>
<script>
var TaxServiceApi = {
	apiBase:'/addon/vhctax/api/',
	saveTemplateUri: 'tmpl/save',
	getPaymentTemplateUri: 'tmpl/get',
	removeTemplateUri:'tmpl/remove',
	listTemplateUri:'tmpl/list',
	vehicleListUri:'vehicle/list',
	saveTaxPaymentTaskUri: 'task/save',
	listPaymentTaskUri: 'task/list',
	removePaymentTaskUri:'task/remove',
	savePaymentTemplate: function(tmplJson, callback) {
		Api.postJson(this.apiBase + this.saveTemplateUri, tmplJson, callback, function(response) {
			callback({success:false, status: {description: 'Failed due to communication error!'}});
		});
	},
	removePaymentTemplate: function(id, callback) {
		Api.sendGet(this.apiBase + this.removeTemplateUri + '/' + id, callback, function(res) {
			callback({success:false, status: {description: 'Failed due to communication error!'}});
		});
	},
	listPaymentTemplate: function(callback) {
		Api.sendGet(this.apiBase + this.listTemplateUri, callback, function(res) {
			callback({success:false, status: {description: 'Failed due to communication error!'}});
		});
	},
	getPaymentTemplate: function(id, callback) {
		Api.sendGet(this.apiBase + this.getPaymentTemplateUri + '/' + id, callback, function(res) {
			callback({success:false, status: {description: 'Failed due to communication error!'}});
		});
	},
	getVehicleList: function(callback) {
		Api.sendGet(this.apiBase + this.vehicleListUri, callback, function(res) {
			callback({success:false, status: {description: 'Failed due to communication error!'}});
		});
	},
	saveTaxPaymentTask: function(taxPaymentObj, callback) {
		Api.postJson(this.apiBase + this.saveTaxPaymentTaskUri, taxPaymentObj, callback, function(response) {
			callback({success:false, status: {description: 'Failed due to communication error!'}});
		});
	},
	listPaymentTask: function(searchCond, callback) {
		Api.postJson(this.apiBase + this.listPaymentTaskUri, searchCond, callback, function(response) {
			callback({success:false, status: {description: 'Failed due to communication error!'}});
		});
	},
	removePaymentTask: function(taskIdList, callback) {
		Api.postJson(this.apiBase + this.removePaymentTaskUri, taskIdList, callback, function(response) {
			callback({success:false, status: {description: 'Failed due to communication error!'}});
		});
	}
};

function buildVhcList(vhcList) {
	var $tbody = $registFrm.find(".ui.table > tbody:first");
	var $item = $("<tr></tr>");
	var $cloned;
	$tbody.empty();
	for(var i = 0; i < vhcList.length; i++) {
		$cloned = $item.clone(false);
		$cloned.append("<td>" + vhcList[i].label + "</td>");
		$cloned.data("vhc", vhcList[i]);
		$tbody.append($cloned);
	}
}
function buildTmplDropdown(tmplList) {
	var $item = $("<div class='item'></div>");
	var $clone;
	var $templateDropdown = $("#templateDropdown");
	var $dropdownContainer = $templateDropdown.find(".ui.menu:first");
	$dropdownContainer.empty();
	for(var i = 0; i < tmplList.length; i++) {
		$clone = $item.clone(false);
		$clone.data('value', tmplList[i].id);
		$clone.data("tmpl", tmplList[i]);
		$clone.append(tmplList[i].title);
		$dropdownContainer.append($clone);
	}
}
function applyTemplate(text, value, $item) {
 	if(!$item) {return;}
	var tmpl = $item.data("tmpl");
	tmpl.certificationCost = addCommas(tmpl.certificationCost);
	tmpl.taxCost = addCommas(tmpl.taxCost);
	var certMap = {}, taxMap = {};
	certMap.cost = addCommas(tmpl.certificationCost);
	certMap.remindBeforeDays = tmpl.certificationRemindBeforeDays;
	taxMap.cost = addCommas(tmpl.taxCost);
	taxMap.remindBeforeDays = tmpl.taxRemindBeforeDays;
	
	$registFrm.form("set values", tmpl);
	$certRegistFrm.form('set values', certMap);
	$taxRegistFrm.form('set values', taxMap);
	
	certValidTill.datepicker( "option", "defaultDate", "+" + tmpl.certificationInterval + "y");
	taxValidTill.datepicker( "option", "defaultDate", "+" + tmpl.taxInterval + "y");
}
function applyVehicle(vhc) {
	$registFrm.form('set value', 'vehicleId', vhc.id);
	$registFrm.form('set value', 'label', vhc.label);
	$registFrm.form('set value', 'model', vhc.model);
	$registFrm.form('set value', 'plateNo', vhc.reg_number);
	$registFrm.form('set value', 'vin', vhc.vin);
}
function showRegistModal(addButton) {
	$addButton = $(addButton);
	$addButton.addClass("loading");
	TaxServiceApi.getVehicleList(function(response) {
		if(response.success) {
			TaxServiceApi.listPaymentTemplate(function(tmplResponse) {
				if(tmplResponse.success) {
					buildVhcList(response.payload);
					buildTmplDropdown(tmplResponse.payload);
					$registFrm.form('clear');
					$registFrm.find(".ui.checked.radio.checkbox:first").checkbox("set checked");
					$certRegistFrm.find(".field").removeClass("disabled");
					$taxRegistFrm.find(".field").removeClass("disabled");
					$certRegistFrm.form('set value', 'taskType', 'C');
					$taxRegistFrm.form('set value', 'taskType', 'T');
					$registModal.modal("show");
				} else {
					alert(tmplResponse.status.description);
				}
			});
		} else {
			alert(response.status.description);
		}
		$addButton.removeClass("loading");
	});
}
function saveRegistration() {
	var vehicleId = $registFrm.form('get value', 'vehicleId');
	if(!vehicleId) {
		FormUI.displayMsgIn($registFrm, 'Vehicle has to be selected!!');
		return;
	}
	
	var taskType = $registFrm.form("get value", "applyTo");
	var taskList = [];
	if(taskType == 'all') {
		var certFrmValid = $certRegistFrm.form('validate form');
		var taxFrmValid = $taxRegistFrm.form('validate form');
		if(!certFrmValid  || !taxFrmValid) return;
		taskList.push(getFrmValueMap($certRegistFrm));
		taskList.push(getFrmValueMap($taxRegistFrm));
		
	} else if(taskType == 'cert') {
		if(!$certRegistFrm.form('validate form')) return;
		taskList.push(getFrmValueMap($certRegistFrm));
		
	} else if(taskType == 'tax') {
		if(!$taxRegistFrm.form('validate form')) return;
		taskList.push(getFrmValueMap($taxRegistFrm));
	} else {
		console.log('unknown registration');
		return;
	}
	var taskObj;
	var vhcMap = $registFrm.form('get values');
	for(var i = 0; i < taskList.length; i++) {
		taskObj = taskList[i];
		taskObj.notificationSms = vhcMap.notificationSms;
		taskObj.notificationEmail = vhcMap.notificationEmail;
		taskObj.vehicleId = vhcMap.vehicleId;
		taskObj.label = vhcMap.label;
		taskObj.model = vhcMap.model;
		taskObj.plateNo = vhcMap.plateNo;
		taskObj.vin = vhcMap.vin;
		console.log(taskObj);
	}
	TaxServiceApi.saveTaxPaymentTask(taskList, function(response) {
		if(response.success) {
			hideRegistModal();
			listTaxPaymentTask();
		} else {
			alert(response.status.description);
		}
	});
}
function getFrmValueMap($frm) {
	var valueMap = $frm.form('get values');
	valueMap.cost = valueMap.cost.replace(/\,/g,"");
	return valueMap;
}
function hideRegistModal() {
	$registModal.modal("hide");
	FormUI.resetMsgIn($registFrm);
}

function listTaxPaymentTask() {
	$tableLoader.addClass("active");
	var actionParam = $actionFrm.form('get values');
	TaxServiceApi.listPaymentTask(actionParam, function(response) {
		if(response.success) {
			buildTaskTable(response.payload);
		} else {
			console.log(response.status.description);
		}
		setTimeout(function() { $tableLoader.removeClass("active");}, 400);
	});
}
function buildTaskTable(taskList) {
	var $TBODY = $taskListTable.find(">tbody");
	$TBODY.empty();
	var $TR = $("<tr></tr>"), $clonedTR;
	if(taskList.length == 0) {
		$clonedTR = $TR.clone(false);
		$clonedTR.append("<td class='center aligned' colspan='8'>No matched data found.</td>");
		$TBODY.append($clonedTR);
		return;
	}
	for(var i = 0; i < taskList.length; i++) {
		$clonedTR = $TR.clone(false);
		$clonedTR.append("<td class='collapsing'><div class='ui task checkbox no-label'><input type='checkbox'></div></td>");
		$clonedTR.append("<td>" + taskList[i].label + "</td>");
		$clonedTR.append("<td>" + taskList[i].model + "</td>");
		$clonedTR.append("<td>" + taskList[i].plateNo + "</td>");
		$clonedTR.append("<td>" + (taskList[i].taskType == 'C' ? 'Certification' : 'Tax') + "</td>");
		$clonedTR.append("<td class='right aligned'>" + addCommas(taskList[i].cost) + "</td>");
		$clonedTR.append("<td>" + taskList[i].dateValidTill + "</td>");
		$clonedTR.append("<td>" + (taskList[i].paid ? 'Paid': 'Unpaid') + "</td>");
		$clonedTR.data('taskid', taskList[i].id);
		$TBODY.append($clonedTR);
	}
	$TBODY.find(".ui.checkbox.no-label").checkbox({onChange: function() {
		var $chk = $(this).parent();/*find the actual checkbox class this represens input box*/
		if($chk.checkbox('is checked')) {
			$chk.closest('tr').addClass('error');
		} else {
			$chk.closest('tr').removeClass('error');
		}
	}});
}
function getAllCheckTaskIds() {
	var chkIdList = [];
	$taskListTable.find(">tbody > tr> td> .ui.task.checkbox").each(function() {
		var $this = $(this);
		if($this.checkbox('is checked')) chkIdList.push($this.closest('tr').data('taskid'));
	});
	return chkIdList;
}
function removeCheckedTask(actionButton) {
	var chkIdList = getAllCheckTaskIds();
	if(chkIdList.length == 0) return;
	var $actionButton = $(actionButton);
	DialogUI.confirmOk("Delete (" + chkIdList.length + ") payment task(s)", function(result) {
		if(result) {
			$actionButton.addClass("loading");
			TaxServiceApi.removePaymentTask(chkIdList, function(response) {
				if(response.success) {
					listTaxPaymentTask();
				} else {
					alert(response.status.description);
				}
				setTimeout(function() {$actionButton.removeClass("loading"); }, 300);
			});
		}
	});
	
}
var $registModal, $actionFrm, $taskListTable, $tableLoader, $actionButtons, $registFrm, $certRegistFrm, $taxRegistFrm, $templateDropdown, certValidTill, taxValidTill;
$(function() {
	$actionFrm = $("#actionFrm");
	$actionButtons = $("#actionButtons");
	$taskListTable = $("#taskListTable");
	$tableLoader = $("#taskTableLoader");
	$registModal = $("#registModal");
	$registFrm = $registModal.find(">.form");
	$certRegistFrm = $registFrm.find("#certRegistFrm");
	$taxRegistFrm = $registFrm.find("#taxRegistFrm");
	$templateDropdown = $("#templateDropdown");
	$registModal.modal({dimmerSettings:{opacity: 0.3}, autofocus:false, closable:false});
	$taskListTable.find(".ui.checkbox.chkAll:first").checkbox();
	$(".ui.dropdown").dropdown();
	
	function getDate(element) {
		var date;
		try {date = $.datepicker.parseDate("yy-mm-dd", element.value );} catch(error) { date = null; }
		return date;
	}
	from = $("#fromDate").datepicker({dateFormat:'yy-mm-dd', defaultDate: "0d", numberOfMonths:2, changeMonth: true, changeYear:true})
	.on("change", function() {
		to.datepicker("option", "minDate", getDate(this));
	}),
	to = $("#toDate" ).datepicker({dateFormat:'yy-mm-dd', defaultDate: "+4w", numberOfMonths:2, changeMonth: true, changeYear: true})
	.on("change", function() {
		from.datepicker( "option", "maxDate", getDate(this));
	});
	from.datepicker('setDate', '0d');
	to.datepicker('setDate', '+4w');
	certValidTill = $("#certValidTill").datepicker({dateFormat: 'yy-mm-dd', numberOfMonths: 1, changeMonth: true, changeYear: true});
	taxValidTill = $("#taxValidTill").datepicker({dateFormat: 'yy-mm-dd', numberOfMonths: 1, changeMonth: true, changeYear: true});
	$registModal.find(".ui.table:first > tbody").on("click", "> tr", function() {
		var $this = $(this);
		$this.parent().find("tr").removeClass("selected");
		$this.addClass("selected");
		applyVehicle($this.data("vhc"));
	});
	$actionFrm.find(".ui.add.button:first").click(function() {showRegistModal(this);});
	$actionFrm.find(".ui.search.button:first").click(listTaxPaymentTask);
	$taskListTable.find(">thead>tr>th>.ui.chkAll.checkbox:first").click(function() {
		var allChk = $(this).checkbox('is checked');
		$taskListTable.find(">tbody > tr> td> .ui.task.checkbox").each(function() {
			var $this = $(this);
			$this.checkbox(allChk? 'check': 'uncheck');/*set checked or set unchecked won't fire onChange event callback*/
		});
	});	
	
	$templateDropdown.dropdown({onChange: applyTemplate});
	$certRegistFrm.form({fields: {registrationNo: 'empty', dateValidTill: 'empty', cost:'empty', remindBeforeDays: 'empty'}});
	$taxRegistFrm.form({fields: {registrationNo: 'empty', dateValidTill: 'empty', cost:'empty', remindBeforeDays: 'empty'}});
	$registFrm.find(".ui.checkbox.radio.applyTo").click(function() {
		var $this = $(this);
		if($this.hasClass('all')) {
			$certRegistFrm.find(".field").removeClass("disabled");
			$taxRegistFrm.find(".field").removeClass("disabled");
		} else if($this.hasClass('cert')) {
			$taxRegistFrm.find(".field").addClass("disabled");
			$certRegistFrm.find(".field").removeClass("disabled");
		} else if($this.hasClass('tax')) {
			$certRegistFrm.find(".field").addClass("disabled");
			$taxRegistFrm.find(".field").removeClass("disabled");
		} else {
			console.log('unkown radio checkbox state', $this.attr('class'));
		}
	});
	$registFrm.find(".ui.button").click(function() {
		var $this = $(this);
		if($this.hasClass("close")) {
			hideRegistModal();
		} else if($this.hasClass("save")) {
			saveRegistration();
		}
	});
	var cleave = new Cleave('.taxcost-input', {
	    numeral: true,
	    numeralThousandsGroupStyle: 'thousand'
	});
	cleave = new Cleave('.certcost-input', {
	    numeral: true,
	    numeralThousandsGroupStyle: 'thousand'
	});
	listTaxPaymentTask();
	
	$actionButtons.find(".remove.button").click(function() {removeCheckedTask(this); });
	DialogUI.init();/*call only when I want to use dialog ui*/
});
</script>
</body>
</html>
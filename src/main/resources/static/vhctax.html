<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  	<link rel="stylesheet" type="text/css" href="/css/nprogress.css">
  	<link rel="stylesheet" type="text/css" href="/css/jquery-ui.min.css">
	<link rel="stylesheet" type="text/css" href="/css/modules.min.css">
	<link rel="stylesheet" type="text/css" href="/css/scrolltabs.css">
	<link rel="stylesheet" type="text/css" href="/css/report.css">
<style>
	.right-column-content-container {min-width: 1000px;}
	.ui.checkbox.no-label {font-size: 0;}
</style>
	<title>Next Generation Smart FMS Platform</title>
</head>
<body>
<div class="ui fixed main secondary small blue inverted menu" id="topMenu">
	<div class="ui container">
		<a class="tracking enabled item"><i class="road icon"></i> Vehicle Tracking</a>
		<a class="fuel report enabled item"><i class="bar chart icon"></i> Fuel Efficiency</a>
		<a class="filling report enabled item"><i class="chart line icon"></i> Filling</a>
		<a class="draining report item"><i class="chart line icon"></i> Draining</a>
		<a class="vehicle tax active enabled item"><i class="yellow tasks icon"></i> Vehicle Tax</a>
		<div class="right menu">
			<a class="ui logout item" href="/login.html" title="Sign out"><i class="sign-out icon"></i></a>
		</div>
	</div>
</div>

<div class="main-container">
	<div class="left-column">
		<div class="ui raised segment">
			<div class="ui blue top attached label"><i class="rupee sign icon"></i>Vehicle Tax Management</div>
			<div class="left-column-content-container">	
				<div class="ui blue vertical fluid secondary pointing small menu" id="taxSubMenu">
					<a class="active payment task item"><i class="bell icon"></i>Vehicle Tax Payment Task</a>
					<a class="tax template item"><i class="copy icon"></i>Payment Task Templates</a>
	   			</div>
	   		</div>
		</div>
	</div>
	<div class="right-column">
		<div class="right-column-content-container">
			<div class="ui small form" id="actionFrm" style="padding-top: 0.5em;">
				<div class="inline fields">
					<div class="four wide field">
						<label>Group by:</label>
						<div class="ui selection dropdown" style="min-width: 11em;">
							<i class="dropdown icon"></i>
							<div class="default text">Do not Group By</div>
							<div class="ui menu">
								<div class="item" data-value="garage">Garage</div>
								<div class="item" data-value="fuel">Fuel Type</div>
								<div class="item" data-value="vtype">Vehicle Type</div>
							</div>
						</div>
					</div>
					<div class="four wide field">
						<label>Payment type:</label>
						<div class="ui selection dropdown" style="min-width: 11em;">
							<i class="dropdown icon"></i>
							<div class="default text">All</div>
							<div class="ui menu">
								<div class="item" data-value="x">Certification No.</div>
								<div class="item" data-value="a">Tax No.</div>
							</div>
						</div>
					</div>
					<div class="six wide inline field">
						<label>Period:</label>
						<div class="ui small left icon input">
							<input type="text" placeholder="Date from" id="fromDate" name="fromDate"><i class="calendar alternate outline icon"></i>
						</div>
						&nbsp;~&nbsp;
						<div class="ui small right icon input">
							<input type="text" placeholder="Date to" id="toDate" name="toDate"><i class="calendar alternate outline icon"></i>
						</div>
					</div>
					<div class="three wide field">
						<div class="ui orange tiny compact icon basic add button" title="add new tax payment task"><i class="plus icon"></i></div>
						<div class="ui tiny compact icon basic button"><i class="check icon"></i></div>
						<div class="ui tiny compact icon basic button"><i class="print icon"></i></div>
						<div class="ui tiny compact icon basic button"><i class="trash alternate icon"></i></div>
					</div>
				</div>
			</div>
			<table class="ui celled teal striped compact small sortable table" id="vhcListTable" style="margin-top: 0.2em;">
				<thead>
				<tr>
					<th class="center aligned collapsing"><div class="ui checkbox no-label"><input type="checkbox" name="chkAll"></div></th>
					<th class="center aligned">Label</th>
					<th class="center aligned">Model</th>
					<th class="center aligned">Plate No.</th>
					<th class="center aligned">Payment Type</th>
					<th class="center aligned">Cost</th>
					<th class="center aligned">Due Date</th>
					<th class="center aligned">Status</th>
				</tr>
				</thead>
				<tbody></tbody>
			</table>
		</div><!-- end of right column content container -->
	</div><!--  end of right column -->
</div><!-- end of main -->
<div class="ui segment modal" id="registModal">
	<div class="ui small form">
		<div class="fields">
			<div class="four wide field">
				<div class="ui small tag label"><i class="car icon"></i> Vehicle List</div>
				<div class="ui divider" style="margin: 0.5em 0;"></div>
				<div style="overflow: auto; max-height: 300px;"><table class="ui small striped small basic selectable table"><tbody></tbody></table></div>
				
			</div>
			<div class="twelve wide field">
				<div class="ui basic segment">
				</div>
			</div>
		</div>
		<div class="error-description field"></div>
		<div class="field">
			<div style="text-align: center;">
				<div class="ui blue right labeled icon small basic save compact button">Save<i class="save icon"></i></div>
				<div class="ui right labeled icon small basic close compact button">Close <i class="x icon"></i></div>
			</div>	
		</div>
	</div>
	
</div>
<script src="/js/nprogress.js"></script>
<script src="/js/jquery-3.1.1.min.js"></script>
<script src="/js/jquery-ui.min.js"></script>
<script src="/js/jquery.tablesort.min.js"></script>
<script src="/js/modules.min.js"></script>
<script src="/js/common.api.js"></script>
<script src="/js/common.js?v=1.1"></script>
<script>
var TaxServiceApi = {
	apiBase:'/vhctax/api/',
	createTemplateUri: 'tmpl/create',
	getPaymentTemplateUri: 'tmpl/get',
	removeTemplateUri:'tmpl/remove',
	listTemplateUri:'tmpl/list',
	vehicleListUri:'vehicle/list',
	savePaymentTemplate: function(tmplJson, callback) {
		Api.postJson(this.apiBase + this.createTemplateUri, tmplJson, callback, function(response) {
			callback({success:false, status: {description: 'Failed due to communication error!'}});
		});
	},
	removePaymentTemplate: function(id, callback) {
		Api.sendGet(this.apiBase + this.removeTemplateUri + '/' + id, callback, function(res) {
			callback({success:false, status: {description: 'Failed due to communication error!'}});
		});
	},
	listPaymentTemplate: function(callback) {
		Api.sendGet(this.apiBase + this.listTemplateUri, callback, function(res) {
			callback({success:false, status: {description: 'Failed due to communication error!'}});
		});
	},
	getPaymentTemplate: function(id, callback) {
		Api.sendGet(this.apiBase + this.getPaymentTemplateUri + '/' + id, callback, function(res) {
			callback({success:false, status: {description: 'Failed due to communication error!'}});
		});
	},
	getVehicleList: function(callback) {
		Api.sendGet(this.apiBase + this.vehicleListUri, callback, function(res) {
			callback({success:false, status: {description: 'Failed due to communication error!'}});
		});
	}
};

function buildVhcList(vhcList) {
	var $tbody = $registFrm.find(".ui.table > tbody:first");
	var $item = $("<tr></tr>");
	var $cloned;
	$tbody.empty();
	for(var i = 0; i < vhcList.length; i++) {
		$cloned = $item.clone(false);
		$cloned.append("<td>" + vhcList[i].label + "</td>");
		$tbody.append($cloned);
	}
}
function showRegistModal(addButton) {
	$addButton = $(addButton);
	$addButton.addClass("loading");
	TaxServiceApi.getVehicleList(function(response) {
		if(response.success) {
			buildVhcList(response.payload);
			$registModal.modal("show");
		} else {
			alert(response.status.description);
		}
		$addButton.removeClass("loading");
	});
}
function saveRegistration() {
	
}
function hideRegistModal() {
	$registModal.modal("hide");
}
	var $registModal, $actionFrm, $registFrm;
	$(function() {
		$actionFrm = $("#actionFrm");
		$registModal = $("#registModal");
		$registFrm = $registModal.find(">.form");
		
		$registModal.modal({dimmerSettings:{opacity: 0.3}, autofocus:false, closable:false});
		$(".ui.checkbox").checkbox();
		$(".ui.dropdown").dropdown();
		$(".ui.sortable.table").tablesort();
		
		function getDate(element) {
			var date;
			try {
				date = $.datepicker.parseDate("yy-mm-dd", element.value );
			} catch(error) { date = null; }
			return date;
		}
		from = $("#fromDate").datepicker({dateFormat:'yy-mm-dd', defaultDate: "0d", numberOfMonths:2, changeMonth: true})
		.on("change", function() {
			to.datepicker("option", "minDate", getDate(this));
		}),
		to = $("#toDate" ).datepicker({dateFormat:'yy-mm-dd', defaultDate: "+4w", numberOfMonths:2, changeMonth: true})
		.on("change", function() {
			from.datepicker( "option", "maxDate", getDate(this));
		});
		$actionFrm.find(".ui.add.button:first").click(function() {
			showRegistModal(this);
		});
		
		$registFrm.find(".ui.button").click(function() {
			var $this = $(this);
			if($this.hasClass("close")) {
				hideRegistModal();
			} else if($this.hasClass("save")) {
				saveRegistration();
			}
		});
		/*getVehicleList();*/
	});
</script>
</body>
</html>